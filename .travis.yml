language: node_js

# Node versions: https://node.green/

matrix:
  include:
    - name: "browsers linux"
      os: "linux"
      node_js: "11.5.0"
#    - name: "browsers osx"
#      os: "osx"
#      node_js: "11.5.0"
#    - name: "browsers windows"
#      os: "windows"
#      node_js: "11.5.0"
    - name: "node old"
      os: "osx"
      node_js: "6.4.0"
      env: NODE_ONLY=true

sudo: false
cache: npm

addons:
  chrome: stable
  firefox: latest
  browserstack:
    username: nikolaymakhonin1
    # You shoud generate this for each repositories.
    # See: https://docs.travis-ci.com/user/encryption-keys
    access_key:
      secure: fH2UuAGzsNHdJy24kqXeYbdYdmUdEGMXV+YmIxB+SsECOWXiUd7++QaSGaulHft7o1Xe9+Mu5VcqOq/NMLqHQCqsoTqojqR/p4LbQWP9AB1RBETOat9FllHzCvdnqMATH2osWlVa8+yXv7zq7dWeCqVLklc8VdELSld+p9wCckaIuoW+/cjcwzPh0qaCg8o7BDODG7ywx7DyrQZ1iLDomLRdNEoOcumx5qcG/FO5YPGA9VAtSja23auOYgQDJTx8Q2/G5zTeYxXBXdujKSQ6XhT6JL7/oXFSmLkaHTOryg7ySm+U0ikVp/xyDEZvXT4oZPppW+zqw1CssnclBotrZ5mfa0kAR5EPnBxJ/pbWb5RKve4NV/TtSmcINLLTAgYjiE7N8x9lNBzhVrYTWwc6HMbIeuMQy6Dp1dJ9Mc88Hijs+QIuGHQnAw3hp9yrWHGvYXWfFwmRNYBC68NHSrRTzDZlG02vM34yumnrGrsT0VhX5SkqlRhCkuGXTSFngot36zVWJlfGhFghCj87RQ+dMdW4NYzgBUunpaCAtF6p2aJ7ZZIY/DDD4RWibOGVZrNNlMWaSP55eK0LoZAmS4R9fq1Ci5AtfezoZzlJYPmevvVUQLFuLL6Ud/jsyQknjTcdlGRgOKc6LVuzsrbLxsysXGr7+QOukSlbeoVShK9J82M=

services:
  - xvfb

before_install:
  # Skip updating shrinkwrap / lock
  - "npm config set shrinkwrap false"
  - "npm install coveralls"

  # Setup Node.js version-specific dependencies
  - "test $(echo $TRAVIS_NODE_VERSION | cut -d. -f1) -ge 4 || npm rm --save-dev $(grep -E '\"eslint\\S*\"' package.json | cut -d'\"' -f2)"

  # Update Node.js modules
  - "test ! -d node_modules || npm prune"
  - "test ! -d node_modules || npm rebuild"
  -
before_script:
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then export DISPLAY=:99.0; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then sh -e /etc/init.d/xvfb start; fi
  - sleep 3 # give xvfb some time to start

script:
  - if [[ ${NODE_ONLY} == true ]]; then
      npm run test:mocha;
    else
      npm run ci;
    fi
